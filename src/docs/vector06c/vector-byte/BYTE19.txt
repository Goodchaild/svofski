			" а ю и р - 1 9 "

		           йХПНБ, 1993
                  ХМТНПЛЮЖХНММН-ПЕЙКЮЛМШИ БШОСЯЙ
			  ЖЕМРПЮ "аюир"
                 ДКЪ ОНКЭГНБЮРЕКЕИ ой "бЕЙРНП-06ж"

 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 +  мЮЬ ЮДПЕЯ: Ц. йХПНБ, нЙРЪАПЭЯЙХИ ОП-Р, 118, Л-М "дНЛ пЮДХН" + 
 +   юДПЕЯ ДКЪ ОХЯЕЛ" 610006, Ц.йХПНБ, Ю/Ъ 1248, гСАЙНБС ю.м.   +
 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++


		дКЪ КЧАХРЕКЕИ юЯЯЕЛАКЕПЮ.
		-------------------------

		TITLE	KDSWAP
;
;щРНР ТЮИК ЯНДЕПФХР ДБЕ ОНДОПНЦПЮЛЛШ, ЙНРНПШЕ ОНЛНЦСР БЮЛ НПЦЮМХГНБЮРЭ
;НАЛЕМ ЛЕФДС ЙБЮГХДХЯЙНЛ Х ЩЙПЮММШЛХ ОКНЯЙНЯРЪЛХ МЕ ОПХАЕЦЮЪ Й ТСМЙЖХ-
;ЪЛ лХЙПНдня. рЮЙХЛ НАПЮГНЛ бШ ЛНФЕРЕ ЯНГДЮБЮРЭ ХЦПШ Я БШУНДНЛ Б дня,
;ОНДЦПСФЮРЭ СПНБМХ Я ДХЯЙЮ Х Р.О.
;оНДОПНЦПЮЛЛШ ОНКСВЕМШ ОСРЕЛ ОЕПЕПЮАНРЙХ ЯННРБЕРЯРБСЧЫХУ ОНДОПНЦПЮЛЛ
;ДХЯЙНБНЦН АЕИЯХЙЮ v 2.5 сЯЙНБШЛ х.л.
;
;	ондопнцпюллю TESTSPACE
;
;
;щрю ондопнцпюллю опнбепъер, ябнандем кх 4-И аюмй йбюгхдйю х, еякх мер,
;бшундхр б дня оевюрюъ мю щйпюме опедсопефдемхе "йбюгхдхяй !!!".
;б щрнл яксвюе менаундхлн сдюкхрэ тюикш я йбюгхдхяйю.
;
;б м х л ю м х е !
;щрн фе опедсопефдемхе лнфер онъбхрэяъ х опх яанъу мю дхяйе ю !
;онлмхре на щрнл.
;
;оепед хяонкэгнбюмхел RAMSWAP фекюрекэмн хяонкэгнбюрэ щрс ондопнцпюллс
;бн хгаефюмхе онпвх тюикнб мю йбюгхдхяйе
;
	PUBLIC	TESTSPACE
;
TESTSPACE:
	MVI	C,019H
	CALL	BDOS
	PUSH	PSW
	MVI	C,018H
	CALL	BDOS
	CPI	004H
	MVI	E,000H
	JC	VER1
VER2:	MVI	E,002H
VER1:	MVI	C,00EH
	CALL	BDOS
	ORA	A
	JNZ	SPICBAD
	MVI	C,01FH
	CALL	BDOS
	LXI	D,00005H
	DAD	D
	MOV	E,M
	INX	H
	MOV	D,M
	XCHG
	SHLD	@MEM1
	MOV	A,H
	ORA	A
	JNZ	VER2
	MVI	C,01BH
	CALL	BDOS
	INX	H
	MOV	A,L
	ORA	H
	JZ	SPICBAD
	LXI	B,00019H
	DAD	B
	LXI	D,@MEM2
	MVI	C,004H
@LOOP1:	LDAX	D
	INX	D
	ANA	M
	INX	H
	JNZ	SPICBAD
	DCR	C
	JNZ	@LOOP1
	LHLD	@MEM1
	LXI	B,0FFE8H
	DAD	B
	XCHG
	MOV	M,D
	DCX	H
	MOV	M,E
	POP	PSW
	MOV	E,A
	MVI	C,00EH
	CALL	BDOS
	ORA	A
	JNZ	SPICBAD
;	
	RET
;
SPICBAD:
	LXI	D,BADDSK
	MVI	C,009H
	CALL	BDOS
	RST	0
;
@MEM1:	DW 0000
BADDSK:
	DB 0DH,0AH,'й',7,'б',7,'ю',7,'г',7,'х',7,'д',7,'х',7,'я',7
	DB 'й',7,'!!!',7,'$'
@MEM2:
	DB 0FH,0FFH,0FFH,0F0H,00
;
;
;		ондопнцпюллю RAMSWAP
;
;
;
;щрю ондопнцпюллю налемхбюер щйпюммсч окняйнярэ, мнлеп йнрнпни сйюгюм б
;пецхярпе "B" мю 8-ЛХ йхкнаюирнбши акнй 4-ЦН (онякедмецн) аюмйю йбюгхдхяйю,
;мнлеп йнрнпнцн (0-3) гюдюеряъ б пецхярпе "C"
;
;яндепфхлне пецхярпю "B":		щйпюммюъ окняйнярэ:
;			0			8000H-9FFFH
;			1			A000H-BFFFH
;			2			C000H-DFFFH
;			3			E000H-FFFFH
;
;	опх налеме я окняйнярэч 3 ме гюасдэ гюоперхрэ опепшбюмхъ !
;
;	ондопнцпюллю янупюмъер сйюгюрекэ ярейю х ме янупюмъер пецхярпш
;
;	он бшундс ондопнцпюллю оняшкюер 23H б онпр 10H р.е. дкъ лХЙПНдня
;
;	ондопнцпюллю "бшрюыемю" хг BASIC-дхяйЮ сЯЙНБШЛ х.л. 11/12/92
;
	PUBLIC RAMSWAP		
;
RAMSWAP:
	LXI	H,00000H
	DAD	SP
	SHLD	MEMSTACK	;яНУПЮМХРЭ РЕЙСЫХИ СЙЮГЮРЕКЭ ЯРЕЙЮ
	MOV	A,B
	ANI	003H
	LXI	H,TABSCR
	ADD	L
	MOV	L,A
	MOV	D,M
	MVI	E,000H		;Б DE - ЮДПЕЯ БШАПЮММНИ ОКНЯЙНЯРХ
	MOV	A,C
	ANI	003H
	ADD	A
	LXI	H,TABMEM
	ADD	L
	MOV	L,A
	MOV	A,M
	STA	BLOCKCHK
	INX	H
	MOV	H,M
	MOV	L,E
	SPHL			
	MVI	A,010H
	OUT	010H		;ПЮАНРЮЕЛ Я ВЕРБЕПРШЛ АКНЙНЛ Б ПЕФХЛЕ "ЯРЕЙ"
	LXI	B,00040H	; 8 ЙХКНАЮИР ЩРН 40h АКНЙНБ ОН 128 АЮИР
	LXI	H,TABCHECK
	SHLD	LDR+1
	XCHG
NEXTBLK:			;НАЛЕМ 128 АЮИР ЙБЮГХДХЯЙ - ОКНЯЙНЯРЭ
	POP	D
	MOV	A,M
	MOV	M,E
	MOV	E,A
	ADD	B
	MOV	B,A
	INX	H
	MOV	A,M
	MOV	M,D
	MOV	D,A
	ADD	B
	MOV	B,A
	INX	H
	PUSH	D
	POP	D
	MOV	A,L
	ANI	07FH		
	JNZ	NEXTBLK
	XCHG
LDR:
	LXI	H,000		; мю яюлнл деке гдеяэ ме 0 ! (ЯЛ МХФЕ)
	MOV	M,B		; ГЮОХЯЮРЭ ЙНМРПНКЭМСЧ ЯСЛЛС ДКЪ 128 АЮИР Б
	INX	H		; РЮАКХЖС Х СБЕКХВХРЭ СЙЮГЮРЕКЭ МЮ 1
	SHLD	LDR+1
	XCHG
	MOV	B,A
	DCR	C		; БЯЕ АКНЙХ НАПЮАНРЮММШ ?
	JNZ	NEXTBLK		; МЕР, ОПНДНКФЮРЭ
	LHLD	BLOCKCHK
	DAD	H
	DAD	H
	DAD	H
	DAD	H
	SPHL
	MVI	A,03FH		; МСКЕБНИ АЮМЙ Б ДБСУ ПЕФХЛЮУ
	OUT	010H
	LXI	H,TABCHECK	; ДЮКЕЕ ГЮОХЯЭ Б щд ЙНМРПНКЭМШУ ЯСЛЛ
	MVI	B,040H
NEXTCHCK:
	MOV	D,M
	INX	H
	MOV	E,D
	PUSH	D
	DCR	B
	JNZ	NEXTCHCK
	MVI	A,023H
	OUT	010H
	LHLD	MEMSTACK	; БНЯЯРЮМНБХРЭ ЯРЕЙ
	SPHL
	RET
;
; рюакхжш:
TABSCR:
	DB 80H,0A0H,0C0H,0E0H
TABMEM:
	DB 0ECH,000,0E4H,020H,0DCH,040H,0D4H,060H
BLOCKCHK:
	DB 000,0FH
TABCHECK:
	DS	40H	; ЙНМРПНКЭМШЕ ЯСЛЛШ
MEMSTACK:
	DW 0000		; ГДЕЯЭ УПЮМХРЯЪ ЮДПЕЯ ЯРЕЙЮ
@MEM3:
	DW 0000
@MEM4:
	DW 0000
BDOS 	EQU	00005H
	END
----------------------------------------------------------------

		сПНЙХ юЯЯЕЛАКЕПЮ ДКЪ МЮВХМЮЧЫХУ
		-------------------------------
		

;сопюфмемхе 1

;меоняпедярбеммюъ гюцпсгйю пецхярпнб
мюв:    MVI  A,12     ;гюцпсгхрэ деяърхвмне вхякн
        MVI  C,0CH    ;гюцпсгхрэ ьеярмюджюпхрхвмне вхякн
        LXI  H,110FH  ;гюцпсгхрэ дюммше б оюпс пецхярпнб
        LXI  D,лер1   ;гюцпсгхрэ юдпея б оюпс пец. (DE)
;оепелеьемхе хг пецхярпю б пецхярп
        MOV  C,E      ;б (C) хг (E)
        MOV  B,D      ;б (B) хг (D)
        MOV  A,H      ;б (ю) хг (H)
        XCHG          ;налемхбюер яндепфхлне (DE) х (HL)
;опълюъ гюцпсгйю хг оюлърх
        LHLD лер2     ;гюцпсгхрэ (HL) хг ъвеей лер2,лер2+1
        LDA  лер2     ;гюцпсгхрэ (A) хг ъвеийх лер2
;йнябеммюъ гюцпсгйю юййслскърнпю хг оюлърх
        MOV  A,M      ;юдпея ъвеийх б оюпе пецхярпнб (HL)
        LDAX D        ;юдпея ъвеийх б оюпе пецхярпнб (DE)
        LDAX B        ;юдпея ъвеийх б оюпе пецхярпнб (BC)
        JMP  мюв
лер1:   DB   0C3H     ;б ъвеийс лер1 онлеыюел вхякн 0C3H
лер2:   DW   лер1     ;б лер2,лер2+1 юдпея ъвеийх лер1

;сопюфмемхе 2

;гюонлхмюмхе х гюцпсгйю пецхярпнб хг оюлърх
мюв:    MVI  A,75H    ;гюцпсгхрэ дюммше
        STA  лер1     ;опълне гюонлхмюмхе (A) б лер1
        LXI  H,3FA5H  ;гюцпсгхрэ дюммше
        SHLD лер2     ;опълне гюонлхмюмхе (L) б лер2, (H) б лер2+1
;йнябеммне гюонлхмюмхе
        LXI  H,лер1   ;гюцпсгхрэ юдпея б (HL)
        MVI  C,35H    ;гюцпсгхрэ дюммше б пецхярп (C)
        MOV  M,C      ;гюонлмхрэ пецхярп (C) б лер1
        MOV  A,M      ;гюцпсгхрэ (A) хг оюлърх
        MVI  M,0FEH   ;гюонлмхрэ дюммше б оюлърх
        MOV  A,M      ;гюцпсгхрэ (A) хг оюлърх
        XCHG          ;оепеякюрэ юдпея хг (HL) б (DE)
        STAX D        ;гюонлмхрэ (A) он юдпеяс хг (DE)
        MOV  C,E      ;гюцпсгхрэ юдпея б (BC
        MOV  B,D      ;
        MOV  A,H      ;йнябеммне гюонлхмюмхе пецхярпю (H)
        STAX B        ;он юдпеяс хг оюпш пецхярпнб (BC)
        JMP  мюв
лер1:   DS   1        ;пегепбхпсел 1 аюир
лер2:   DS   2        ;пегепбхпсел 1 якнбн

;сопюфмемхе 3

;юпхтлерхвеяйхе ноепюжхх
мюв:    MVI  A,0C2H   ;гюцпсгхрэ дюммше б (A)
        LXI  B,6E12H  ;гюцпсгхрэ дюммше б (BC)
        ADD  B        ;(ю) <= (A) + (B)
        ADC  C        ;(A) <= (A) + (C) + ткюц оепемняю
        LXI  H,12F5H  ;гюцпсгхрэ дюммше дкъ
        LXI  D,200EH  ;ьеярмюджюпхрхвмнцн якнфемхъ
        DAD  D        ;(HL) <= (HL) + (DE)
        DAD  B        ;(HL) <= (HL) + (BC)
        MVI  A,38H    ;деяърхвмне якнфемхе
        ADI  15H      ;(A) <= 38H + 15H
        DAA           ;йнппейрхпнбюрэ б деяърхвмши бхд
;ьеярмюджюпхрхвмне бшвхрюмхе (HL) <= (HL) - (DE)
        MOV  A,L      ;бшвхрюел лкюдьхе аюирш L=L-E
        SUB  E        ;еякх (е) > (L), рн ткюц оепемняю=1
        MOV  L,A      ;гюонлхмюел лкюдьхи аюир пегскэрюрю
        MOV  A,H      ;бшвхрюел ярюпьхе аюирш я свернл оепемняю
        SBB  D        ;(ю) <= (ю) - (D) - ткюц оепемняю
        MOV  H,A      ;гюонлхмюел ярюпьхи аюир пегскэрюрю
        JMP  мюв

;сопюфмемхе 4

;кнцхвеяйхе ноепюжхх
мюв:    MVI  A,95H    ;гюцпсгхрэ дюммше
        ORI  20H      ;кнцхвеяйне "хкх"
        XRI  63H      ;хяйкчвючыее "хкх"
        RAL           ;ядбхц бкебн вепея оепемня
        ANI  0F0H     ;кнцхвеяйне "х"
        RLC           ;жхйкхвеяйхи ядбхц бкебн
        XRI  42H      ;хяйкчвючыее "хкх"
        RRC           ;жхйкхвеяйхи ядбхц бопюбн
        CMA           ;хмбепрхпнбюрэ (A)
        RAR           ;ядбхц бопюбн вепег оепемня
        MOV  C,A      ;гюцпсгхрэ пецхярп (C)
        STC           ;сярюмнбхрэ ткюц оепемняю CY=1
        XRA  A        ;нвхярхрэ ткюц оепемняю CY=0
        CMC           ;хмбепрхпнбюрэ ткюц оепемняю
        XRA  C        ;кнцхвеяйюъ ноепюжхъ я пецхярпнл
        LXI  H,лер1   ;гюцпсгхрэ юдпея
        ORA  M        ;кнцхвеяйюъ ноепюжхъ я оюлърэч
        JMP  мюв
лер1:   DB   0F0H     ;нопедекхрэ аюир б оюлърх

;сопюфмемхе 5

;ноепюжхх ян ярейнл
мюв:    LXI  SP,75F0H ;гюцпсгхрэ сйюгюрекэ ярейю
        LXI  B,8513H  ;гюцпсгхрэ дюммше б (BC)
        PUSH B        ;гюонлмхрэ (BC) б ярейе
;сйюгюрекэ ярейю слемэьхкяъ мю 2
        POP  D        ;гюцпсгхрэ (DE) хг ярейю
;сйюгюрекэ ярейю сбекхвхкяъ мю 2
        MOV  H,D      ;ондцнрнбхрэ дюммше дкъ
        PUSH B        ;делнмярпюжхх йнлюмдш XTHL
        XTHL          ;налем (HL) х бепьхмш ярейю
        XTHL          ;налем (HL) х бепьхмш ярейю
        POP  B        ;бняярюмнбхрэ янярнъмхе ярейю
        MOV  A,B      ;гюцпсгхрэ (A) дкъ мюцкъдмнярх
;бнглнфмнярэ гюцпсгхрэ пецхярп ткюфйнб "F"
        PUSH PSW      ;(A) х (F) б ярей
        POP  H        ;(H) <= (A), (L) <= (F)
        LXI  H,0      ;ондцнрнбхрэ оюпс пецхярпнб (HL)
        DAD  SP       ;б (HL) онксвхрэ юдпея ярейю
        LXI  SP,0     ;нвхярхрэ пецхярп ярейю
        SPHL          ;гюцпсгйю юдпеяю ярейю хг (HL)
        JMP  мюв

;сопюфмемхе 6

;бербкемхе опнцпюллш
мюв:    MVI  B,32H    ;гюцпсгхрэ дюммше б (B)
л1:     ADI  85H      ;цемепхпсел вхякю б юййслскърнпе
        CPI  20H      ;(A) анкэье 20H ?
        JC   л1       ;еякх лемэье,рн хдрх мю л1
        CPI  40H      ;(ю) анкэье 40H ?
        JNC  л1       ;еякх ме лемэье,рн хдрх мю л1
        CMP  B        ;(ю) пюбмн (B) ?
        JNZ  л1       ;еякх ме пюбмн,рн хдрх мю л1
л2:     MOV  C,A      ;янупюмхрэ (A) б (C)
        ANI  4        ;бшдекхрэ пюгпъд 00000100B
        JNZ  л3       ;еякх ме мскэ,рн хдрх мю л3
        ORI  4        ;сярюмнбхрэ пюгпъд б 1
        JMP  л2       ;онбрнпхрэ опнбепйс пюгпъдю
л3:     ORA  A        ;сярюмнбхрэ ткюцх он юййслскърнпс
        JP   л6       ;опхлеп оепеундю он окчяс
л6:     INR  B        ;сярюмнбхрэ ткюцх он пецхярпс
        DCR  B        ;янупюмхб ецн гмювемхе
        JM   л7       ;опхлеп оепеундю он лхмсяс
л7:     XRA  A        ;нвхярхрэ юййслскърнп
        JMP  мюв

;сопюфмемхе 7

;нпцюмхгюжхъ жхйкнб (I)
;опхлеп жхйкю дн 256 онбрнпемхи
мюв:    MVI  C,5      ;сярюмнбхрэ явервхй жхйкнб
л1:     ADI  1        ;опхлеп рекю жхйкю
        DCR  C        ;слемэьхрэ явервхй мю 1
        JNZ  л1       ;онбрнпхрэ,еякх (C) ме мскэ
;опхлеп жхйкю: 16-пюгпъдмши явервхй
        LXI  B,0004   ;сярюмнбхрэ 16-пюгпъдмши явервхй
л2:     ADI  2        ;опхлеп рекю жхйкю
        DCX  B        ;слемэьхрэ явервхй мю 1
        MOV  A,B      ;опнбепхрэ 16-пюгпъдмши явервхй
        ORA  C        ;мю мскэ
        JNZ  л2       ;онбрнпхрэ,еякх (BC) ме мскэ
;опхлеп бкнфеммнцн жхйкю
        MVI  B,2      ;сярюмнбхрэ бмеьмхи явервхй
л3:     MVI  C,3      ;сярюмнбхрэ бмсрпеммхи явервхй
л4:     SUI  1        ;опхлеп рекю жхйкю
        DCR  C        ;слемэьхрэ бмсрпеммхи явервхй
        JNZ  л4       ;онбрнпхрэ,еякх ме мскэ
        JMP  мюв

;сопюфмемхе 8

;нпцюмхгюжхъ жхйкнб (II)
;опхлеп жхйкю нр (HL) дн (DE)-1
мюв:    LXI  H,1100H  ;мювюкэмне гмювемхе (HL)
        LXI  D,1105H  ;йнмевмне гмювемхе (DE)
л1:     MOV  A,M      ;опхлеп рекю жхйкю
        INX  H        ;сбекхвхрэ рейсыее (HL)
        MOV  A,L      ;япюбмхрэ лкюдьхе аюирш
        CMP  E        ;мю янбоюдемхе
        JNZ  л1       ;еякх ме пюбмш,рн хдрх мю л1
        MOV  A,H      ;япюбмхрэ ярюпьхе аюирш
        CMP  D        ;мю янбоюдемхе
        JNZ  л1       ;еякх ме пюбмш,рн хдрх мю л1
;опхлеп жхйкю опх напюанрйе рюакхжш
;1 щкелемр рюакхжш - 1 аюир,ме анкее 256 аюир
        LXI  H,мюв    ;юдпея мювюкю рюакхжш
л2:     MOV  A,M      ;опхлеп рекю жхйкю
        MOV  A,L      ;опнбепхрэ мю йнмеж рюакхжш
        CPI  мюв+6    ;юдпея онякедмецн щкелемрю
        INX  H        ;юдпея якедсчыцн щкелемрю
        JNZ  л2       ;еякх мер,рн напюанрюрэ
        JMP  мюв

;сопюфмемхе 9

;пюанрю я ондопнцпюллюлх (I)
мюв:    CALL SB1      ;бшонкмемхе ондопнцпюллш аег оюпюлерпнб
        LXI  H,2222H  ;гюцпсгхрэ 1 оюпюлепр
        LXI  D,5555H  ;гюцпсгхрэ 2 оюпюлерп
        CALL SB2      ;оепедювю оюпюлерпнб вепег пец.
        CALL SB2      ;делнмярпюжхъ бшундю он ткюцс
        CALL SB3      ;делнмярпюжхъ янупюмемхъ пец.
        JMP  мюв
SB1:    MVI  A,12     ;опхлеп рекю ондопнцпюллш
        RET           ;аегсякнбмши бшунд хг ондопнцпюллш
SB2:    MOV  A,D      ;япюбмхрэ (D) я (H)
        CMP  H        ;
        RC            ;бшунд,еякх (D) < (H)
        DAD  D        ;(HL) <= (HL) + (DE)
        RET
SB3:    PUSH H        ;янупюмхрэ (HL)
        PUSH D        ;янупюмхрэ (DE)
        ANA  A        ;опхлеп рекю ондопнцпюллш
        POP  D        ;бняярюмнбхрэ (DE)
        POP  H        ;бняярюмнбхрэ (HL)
        RET           ;бшунд

;сопюфмемхе 10

;пюанрю я ондопнцпюллюлх (II)
;оепедювю оюпюлерпнб ондопнцпюлле вепег нгс
мюв:    LXI  H,1111H  ;бгърэ оепбши оюпюлерп
        SHLD PR       ;гюохяюрэ б оюлърэ
        LXI  H,2222H  ;бгърэ брнпни оюпюлерп
        SHLD PR+2     ;гюохяюрэ б оюлърэ
        ADI  1        ;нпцюмхгнбюрэ б (A) явервхй
        CPI  2        ;дкъ делнмярпюжхх йнлюмд CC х CZ
        PUSH PSW      ;янупюмхрэ (A) х ткюцх
        CC   SB1      ;бшонкмхрэ ондопнцпюллс,еякх (ю)=0 хкх 1
        POP  PSW      ;бняярюмнбхрэ (A) х ткюцх
        CNC  SB1      ;бшонкмхрэ ондопнцпюллс,еякх (A) >=1
        CPI  3        ;япюбмхрэ явервхй я 3
        CZ   SB1      ;бшонкмхрэ ондпнцпюллс,еякх янбоюкн
        ANI  3        ;нцпюмхвхрэ явервхй
        JMP  мюв
SB1:    LHLD PR+2     ;бгърэ брнпни оюпюлерп
        XCHG          ;оепеякюрэ б (DE)
        LHLD PR       ;бгърэ оепбши оюпюлерп б (HL)
        RET
PR:     DS   4        ;пегепбхпсел нгс онд оюпюлерпш
----------------------------------------------------------------
  